services:
# Web service
- type: web
  name: laravel-app
  runtime: php
  plan: free
  buildCommand: |
    set -ex
    composer install --no-dev --optimize-autoloader
    php artisan config:cache
    php artisan route:cache
    php artisan view:cache
    npm ci
    npm run build
  startCommand: "php artisan serve --host=0.0.0.0 --port=$PORT"
  envVars:
    - key: APP_ENV
      value: production
    - key: APP_DEBUG
      value: false
    - key: APP_URL
      sync: false
    - key: DB_CONNECTION
      value: mysql
    - key: DB_HOST
      sync: false
    - key: DB_PORT
      value: 3306
    - key: DB_DATABASE
      sync: false
    - key: DB_USERNAME
      sync: false
    - key: DB_PASSWORD
      sync: false
    - key: CACHE_DRIVER
      value: file
    - key: QUEUE_CONNECTION
      value: database
    - key: SESSION_DRIVER
      value: file
    - key: APP_KEY
      generateValue: true
  autoDeploy: true